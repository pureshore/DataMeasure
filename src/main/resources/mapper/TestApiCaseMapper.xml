<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.api.agent.mapper.TestApiCaseMapper">
    <!-- 结果映射 -->
    <resultMap id="TestApiCaseMap" type="com.api.agent.dto.TestApiCaseDO">
        <id property="id" column="id"/>
        <result property="jobId" column="job_id"/>
        <result property="testItem" column="test_item"/>
        <result property="caseName" column="case_name"/>
        <result property="caseData" column="case_data"/>
        <result property="status" column="status"/>
        <result property="result" column="result"/>
        <result property="expectCode" column="expect_code"/>
        <result property="actualCode" column="actual_code"/>
        <result property="createTime" column="create_time"/>
        <result property="updateTime" column="update_time"/>
    </resultMap>

    <!-- 插入语句 -->
    <insert id="insert" useGeneratedKeys="true" keyProperty="id">
        INSERT INTO test_api_case (job_id, test_item, case_name, case_data, status, result, expect_code, actual_code)
        VALUES (#{jobId}, #{testItem}, #{caseName}, #{caseData}, #{status}, #{result}, #{expectCode}, #{actualCode})
    </insert>

    <!-- 批量插入 -->
    <insert id="batchInsert">
        INSERT INTO test_api_case (job_id, test_item, case_name, case_data, status, result, expect_code, actual_code)
        VALUES
        <foreach collection="list" item="item" separator=",">
            (#{item.jobId}, #{item.testItem}, #{item.caseName}, #{item.caseData}, #{item.status}, #{item.result}, #{item.expectCode}, #{item.actualCode})
        </foreach>
    </insert>

    <!-- 根据ID更新 -->
    <update id="updateById">
        UPDATE test_api_case
        <set>
            <if test="jobId != null">job_id = #{jobId},</if>
            <if test="testItem != null and testItem != ''">test_item = #{testItem},</if>
            <if test="caseName != null and caseName != ''">case_name = #{caseName},</if>
            <if test="caseData != null">case_data = #{caseData},</if>
            <if test="status != null">status = #{status},</if>
            <if test="result != null">result = #{result},</if>
            <if test="expectCode != null">expect_code = #{expectCode},</if>
            <if test="actualCode != null">actual_code = #{actualCode},</if>
            update_time = CURRENT_TIMESTAMP
        </set>
        WHERE id = #{id}
    </update>

    <!-- 根据ID删除 -->
    <delete id="deleteById">
        DELETE FROM test_api_case WHERE id = #{id}
    </delete>

    <!-- 根据任务ID删除 -->
    <delete id="deleteByJobId">
        DELETE FROM test_api_case WHERE job_id = #{jobId}
    </delete>

    <!-- 根据ID查询 -->
    <select id="selectById" resultMap="TestApiCaseMap">
        SELECT id, job_id, test_item, case_name, case_data, status, result, expect_code, actual_code, create_time, update_time
        FROM test_api_case
        WHERE id = #{id}
    </select>

    <!-- 根据任务ID查询 -->
    <select id="selectByJobId" resultMap="TestApiCaseMap">
        SELECT id, job_id, test_item, case_name, case_data, status, result, expect_code, actual_code, create_time, update_time
        FROM test_api_case
        WHERE job_id = #{jobId}
    </select>

    <!-- 查询所有 -->
    <select id="selectAll" resultMap="TestApiCaseMap">
        SELECT id, job_id, test_item, case_name, case_data, status, result, expect_code, actual_code, create_time, update_time
        FROM test_api_case
    </select>

    <!-- 根据状态查询 -->
    <select id="selectByStatus" resultMap="TestApiCaseMap">
        SELECT id, job_id, test_item, case_name, case_data, status, result, expect_code, actual_code, create_time, update_time
        FROM test_api_case
        WHERE status = #{status}
    </select>

    <!-- 分页查询 -->
    <select id="selectPage" resultMap="TestApiCaseMap">
        SELECT id, job_id, test_item, case_name, case_data, status, result, expect_code, actual_code, create_time, update_time
        FROM test_api_case
        ORDER BY create_time DESC
        LIMIT #{offset}, #{limit}
    </select>

    <!-- 根据任务ID统计数量 -->
    <select id="countByJobId" resultType="int">
        SELECT COUNT(*) FROM test_api_case WHERE job_id = #{jobId}
    </select>

</mapper>